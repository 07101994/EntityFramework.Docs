<!DOCTYPE html>
<!--[if IE]><![endif]-->
<html>
  
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <title>Logging </title>
    <meta name="viewport" content="width=device-width">
    <meta name="title" content="Logging ">
    <meta name="generator" content="docfx 2.5.4.0">
    
    <link rel="shortcut icon" href="../favicon.ico">
    <link rel="stylesheet" href="../styles/docfx.vendor.css">
    <link rel="stylesheet" href="../styles/docfx.css">
    <link rel="stylesheet" href="../styles/main.css">
    <meta property="docfx:navrel" content="../toc.html">
    <meta property="docfx:tocrel" content="../toc.html">
    
  </head>
  <body data-spy="scroll" data-target="#affix">
    <div id="wrapper">
      <header>
        
        <nav id="autocollapse" class="navbar navbar-inverse ng-scope" role="navigation">
          <div class="container">
            <div class="navbar-header">
              <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#navbar">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
              </button>
              <a class="navbar-brand" href="../index.html">
                <img id="logo" class="svg" src="../logo.svg" alt="">
              </a>
            </div>
            <div class="collapse navbar-collapse" id="navbar">
              <form class="navbar-form navbar-right" role="search" id="search">
                <div class="form-group">
                  <input type="text" class="form-control" id="search-query" placeholder="Search" autocomplete="off">
                </div>
              </form>
            </div>
          </div>
        </nav>
        
        <div class="subnav navbar navbar-default">
          <div class="container hide-when-search" id="breadcrumb">
            <ul class="breadcrumb">
              <li></li>
            </ul>
          </div>
        </div>
      </header>
      <div role="main" class="container body-content hide-when-search">
        <div class="article row grid">
          <div class="col-md-10">
            <article class="content wrap" id="_content" data-uid="miscellaneous/logging">
              <h1 id="logging" sourcefile="miscellaneous/logging.md" sourcestartlinenumber="4" sourceendlinenumber="4">Logging</h1>
              
<div class="WARNING sourceFile=" miscellaneous/logging.md"="" sourcestartlinenumber="6" sourceendlinenumber="6" "=""><h5>Warning</h5><p sourcefile="miscellaneous/logging.md" sourcestartlinenumber="7" sourceendlinenumber="7">This documentation is for EF Core. For EF6.x and earlier release see <a href="http://msdn.com/data/ef" sourcefile="miscellaneous/logging.md" sourcestartlinenumber="7" sourceendlinenumber="7"><a href="http://msdn.com/data/ef" sourcefile="miscellaneous/logging.md" sourcestartlinenumber="7" sourceendlinenumber="7">http://msdn.com/data/ef</a></a>.</p>
</div>
<div class="TIP sourceFile=" miscellaneous/logging.md"="" sourcestartlinenumber="9" sourceendlinenumber="9" "=""><h5>Tip</h5><p sourcefile="miscellaneous/logging.md" sourcestartlinenumber="10" sourceendlinenumber="10">You can view this article&#39;s <a href="https://github.com/aspnet/EntityFramework.Docs/tree/master/samples/Miscellaneous/Logging" sourcefile="miscellaneous/logging.md" sourcestartlinenumber="10" sourceendlinenumber="10">sample</a> on GitHub.</p>
</div>
<h2 id="create-a-logger" sourcefile="miscellaneous/logging.md" sourcestartlinenumber="12" sourceendlinenumber="12">Create a logger</h2>
<p sourcefile="miscellaneous/logging.md" sourcestartlinenumber="14" sourceendlinenumber="14">The first step is to create an implementation of <code>ILoggerProvider</code> and <code>ILogger</code>.</p>
<ul sourcefile="miscellaneous/logging.md" sourcestartlinenumber="15" sourceendlinenumber="17">
<li sourcefile="miscellaneous/logging.md" sourcestartlinenumber="15" sourceendlinenumber="15"><p sourcefile="miscellaneous/logging.md" sourcestartlinenumber="15" sourceendlinenumber="15"><code>ILoggerProvider</code> is the component that decides when to create instances of your logger(s). The provider may choose to create different loggers in different situations.</p>
</li>
<li sourcefile="miscellaneous/logging.md" sourcestartlinenumber="17" sourceendlinenumber="17"><p sourcefile="miscellaneous/logging.md" sourcestartlinenumber="17" sourceendlinenumber="17"><code>ILogger</code> is the component that does the actual logging. It will be passed information from the framework when certain events occur.</p>
</li>
</ul>
<p sourcefile="miscellaneous/logging.md" sourcestartlinenumber="19" sourceendlinenumber="19">Here is a simple implementation that logs a human readable representation of every event to a text file and the Console.</p>
<!-- [!code-csharp[Main](samples/Miscellaneous/Logging/Logging/MyLoggerProvider.cs)] -->
<pre sourcefile="miscellaneous/logging.md" sourcestartlinenumber="22" sourceendlinenumber="59"><code class="lang-csharp">using Microsoft.Extensions.Logging;
using System;
using System.IO;

namespace EFLogging
{
    public class MyLoggerProvider : ILoggerProvider
    {
        public ILogger CreateLogger(string categoryName)
        {
            return new MyLogger();
        }

        public void Dispose()
        { }

        private class MyLogger : ILogger
        {
            public bool IsEnabled(LogLevel logLevel)
            {
                return true;
            }

            public void Log&lt;TState&gt;(LogLevel logLevel, EventId eventId, TState state, Exception exception, Func&lt;TState, Exception, string&gt; formatter)
            {
                File.AppendAllText(@&quot;C:\temp\log.txt&quot;, formatter(state, exception));
                Console.WriteLine(formatter(state, exception));
            }

            public IDisposable BeginScope&lt;TState&gt;(TState state)
            {
                return null;
            }
        } 
    }
}
</code></pre><div class="TIP sourceFile=" miscellaneous/logging.md"="" sourcestartlinenumber="61" sourceendlinenumber="61" "=""><h5>Tip</h5><p sourcefile="miscellaneous/logging.md" sourcestartlinenumber="63" sourceendlinenumber="63">The arguments passed to the Log method are:</p>
<ul sourcefile="miscellaneous/logging.md" sourcestartlinenumber="65" sourceendlinenumber="73">
<li sourcefile="miscellaneous/logging.md" sourcestartlinenumber="65" sourceendlinenumber="65"><p sourcefile="miscellaneous/logging.md" sourcestartlinenumber="65" sourceendlinenumber="65"><code>logLevel</code> is the level (e.g. Warning, Info, Verbose, etc.) of the event being logged</p>
</li>
<li sourcefile="miscellaneous/logging.md" sourcestartlinenumber="67" sourceendlinenumber="67"><p sourcefile="miscellaneous/logging.md" sourcestartlinenumber="67" sourceendlinenumber="67"><code>eventId</code> is a library/assembly specific id that represents the type of event being logged</p>
</li>
<li sourcefile="miscellaneous/logging.md" sourcestartlinenumber="69" sourceendlinenumber="69"><p sourcefile="miscellaneous/logging.md" sourcestartlinenumber="69" sourceendlinenumber="69"><code>state</code> can be any object that holds state relevant to what is being logged</p>
</li>
<li sourcefile="miscellaneous/logging.md" sourcestartlinenumber="71" sourceendlinenumber="71"><p sourcefile="miscellaneous/logging.md" sourcestartlinenumber="71" sourceendlinenumber="71"><code>exception</code> gives you the exception that occurred if an error is being logged</p>
</li>
<li sourcefile="miscellaneous/logging.md" sourcestartlinenumber="73" sourceendlinenumber="73"><p sourcefile="miscellaneous/logging.md" sourcestartlinenumber="73" sourceendlinenumber="73"><code>formatter</code> uses state and exception to create a human readable string to be logged</p>
</li>
</ul>
</div>
<h2 id="register-your-logger" sourcefile="miscellaneous/logging.md" sourcestartlinenumber="75" sourceendlinenumber="75">Register your logger</h2>
<h3 id="aspnet-core" sourcefile="miscellaneous/logging.md" sourcestartlinenumber="77" sourceendlinenumber="77">ASP.NET Core</h3>
<p sourcefile="miscellaneous/logging.md" sourcestartlinenumber="79" sourceendlinenumber="79">In an ASP.NET Core application, you register your logger in the Configure method of Startup.cs:</p>
<!-- literal_block"ids  "classes  "xml:space": "preserve", "backrefs  "dupnames  "names": [] -->
<pre sourcefile="miscellaneous/logging.md" sourcestartlinenumber="82" sourceendlinenumber="89"><code>public void Configure(IApplicationBuilder app, IHostingEnvironment env, ILoggerFactory loggerFactory)
{
    loggerFactory.AddProvider(new MyLoggerProvider());

    ...
}
</code></pre><h3 id="other-applications" sourcefile="miscellaneous/logging.md" sourcestartlinenumber="91" sourceendlinenumber="91">Other applications</h3>
<p sourcefile="miscellaneous/logging.md" sourcestartlinenumber="93" sourceendlinenumber="93">In your application startup code, create and instance of you context and register your logger.</p>
<div class="NOTE sourceFile=" miscellaneous/logging.md"="" sourcestartlinenumber="95" sourceendlinenumber="95" "=""><h5>Note</h5><p sourcefile="miscellaneous/logging.md" sourcestartlinenumber="96" sourceendlinenumber="96">You only need to register the logger with a single context instance. Once you have registered it, it will be used for all other instances of the context in the same AppDomain.</p>
</div>
<!-- [!code-csharp[Main](samples/Miscellaneous/Logging/Logging.ConsoleApp/Program.cs)] -->
<pre sourcefile="miscellaneous/logging.md" sourcestartlinenumber="99" sourceendlinenumber="106"><code class="lang-csharp">        using (var db = new BloggingContext())
        {
            var serviceProvider = db.GetInfrastructure&lt;IServiceProvider&gt;();
            var loggerFactory = serviceProvider.GetService&lt;ILoggerFactory&gt;();
            loggerFactory.AddProvider(new MyLoggerProvider());
        }
</code></pre><h2 id="filtering-what-is-logged" sourcefile="miscellaneous/logging.md" sourcestartlinenumber="108" sourceendlinenumber="108">Filtering what is logged</h2>
<p sourcefile="miscellaneous/logging.md" sourcestartlinenumber="110" sourceendlinenumber="110">The easiest way to filter what is logged, is to adjust your logger provider to only return your logger for certain categories of events. For EF, the category passed to your logger provider will be the type name of the component that is logging the event.</p>
<p sourcefile="miscellaneous/logging.md" sourcestartlinenumber="112" sourceendlinenumber="112">For example, here is a logger provider that returns the logger only for events related to executing SQL against a relational database. For all other categories of events, a null logger (which does nothing) is returned.</p>
<!-- [!code-csharp[Main](samples/Miscellaneous/Logging/Logging/MyFilteredLoggerProvider.cs?highlight=9,10,11,12,13,17,18,19,20,21,22)] -->
<pre sourcefile="miscellaneous/logging.md" sourcestartlinenumber="115" sourceendlinenumber="178"><code class="lang-csharp">using Microsoft.Extensions.Logging;
using System;
using System.Linq;

namespace EFLogging
{
    public class MyFilteredLoggerProvider : ILoggerProvider
    {
        private static string[] _categories =
        {
            typeof(Microsoft.EntityFrameworkCore.Storage.Internal.RelationalCommandBuilderFactory).FullName,
            typeof(Microsoft.EntityFrameworkCore.Storage.Internal.SqlServerConnection).FullName
        };

        public ILogger CreateLogger(string categoryName)
        {
            if( _categories.Contains(categoryName))
            {
                return new MyLogger();
            }

            return new NullLogger();
        }

        public void Dispose()
        { }

        private class MyLogger : ILogger
        {
            public bool IsEnabled(LogLevel logLevel)
            {
                return true;
            }

            public void Log&lt;TState&gt;(LogLevel logLevel, EventId eventId, TState state, Exception exception, Func&lt;TState, Exception, string&gt; formatter)
            {
                Console.WriteLine(formatter(state, exception));
            }

            public IDisposable BeginScope&lt;TState&gt;(TState state)
            {
                return null;
            }
        }

        private class NullLogger : ILogger
        {
            public bool IsEnabled(LogLevel logLevel)
            {
                return false;
            }

            public void Log&lt;TState&gt;(LogLevel logLevel, EventId eventId, TState state, Exception exception, Func&lt;TState, Exception, string&gt; formatter)
            { }

            public IDisposable BeginScope&lt;TState&gt;(TState state)
            {
                return null;
            }
        }
    }
}
</code></pre>
            </article>
          </div>
          
          <div class="hidden-sm col-md-2" role="complementary">
            <div class="sideaffix">
              <div class="contribution">
                <ul class="nav">
                  <li>
                    <a href="https://github.com/shirhatti/EntityFramework.Docs/blob/export-qa-fixes/ef/miscellaneous/logging.md/#L1" class="contribution-link">Improve this Doc</a>
                  </li>
                </ul>
              </div>
              <nav class="bs-docs-sidebar hidden-print hidden-xs hidden-sm affix" id="affix">
              <!-- <p><a class="back-to-top" href="#top">Back to top</a><p> -->
              </nav>
            </div>
          </div>
        </div>
      </div>
      
      <footer>
        <div class="grad-bottom"></div>
        <div class="footer">
          <div class="container">
            <span class="pull-right">
              <a href="#top">Back to top</a>
            </span>
            
            <span>Copyright © 2015-2016 Microsoft<br>Generated by <strong>DocFX</strong></span>
          </div>
        </div>
      </footer>
    </div>
    
    <script type="text/javascript" src="../styles/docfx.vendor.js"></script>
    <script>hljs.initHighlightingOnLoad();</script>
    <script type="text/javascript" src="../styles/docfx.js"></script>
    <script type="text/javascript" src="../styles/main.js"></script>
  </body>
</html>
