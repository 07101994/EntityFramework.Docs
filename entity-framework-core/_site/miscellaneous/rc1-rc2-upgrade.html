<!DOCTYPE html>
<!--[if IE]><![endif]-->
<html>
  
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <title>Upgrading from RC1 to RC2 </title>
    <meta name="viewport" content="width=device-width">
    <meta name="title" content="Upgrading from RC1 to RC2 ">
    <meta name="generator" content="docfx 2.5.4.0">
    
    <link rel="shortcut icon" href="../favicon.ico">
    <link rel="stylesheet" href="../styles/docfx.vendor.css">
    <link rel="stylesheet" href="../styles/docfx.css">
    <link rel="stylesheet" href="../styles/main.css">
    <meta property="docfx:navrel" content="../toc.html">
    <meta property="docfx:tocrel" content="../toc.html">
    
  </head>
  <body data-spy="scroll" data-target="#affix">
    <div id="wrapper">
      <header>
        
        <nav id="autocollapse" class="navbar navbar-inverse ng-scope" role="navigation">
          <div class="container">
            <div class="navbar-header">
              <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#navbar">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
              </button>
              <a class="navbar-brand" href="../index.html">
                <img id="logo" class="svg" src="../logo.svg" alt="">
              </a>
            </div>
            <div class="collapse navbar-collapse" id="navbar">
              <form class="navbar-form navbar-right" role="search" id="search">
                <div class="form-group">
                  <input type="text" class="form-control" id="search-query" placeholder="Search" autocomplete="off">
                </div>
              </form>
            </div>
          </div>
        </nav>
        
        <div class="subnav navbar navbar-default">
          <div class="container hide-when-search" id="breadcrumb">
            <ul class="breadcrumb">
              <li></li>
            </ul>
          </div>
        </div>
      </header>
      <div role="main" class="container body-content hide-when-search">
        <div class="article row grid">
          <div class="col-md-10">
            <article class="content wrap" id="_content" data-uid="miscellaneous/rc1-rc2-upgrade">
              <h1 id="upgrading-from-rc1-to-rc2" sourcefile="miscellaneous/rc1-rc2-upgrade.md" sourcestartlinenumber="4" sourceendlinenumber="4">Upgrading from RC1 to RC2</h1>
              
<div class="WARNING sourceFile=" miscellaneous/rc1-rc2-upgrade.md"="" sourcestartlinenumber="6" sourceendlinenumber="6" "=""><h5>Warning</h5><p sourcefile="miscellaneous/rc1-rc2-upgrade.md" sourcestartlinenumber="7" sourceendlinenumber="7">This documentation is for EF Core. For EF6.x and earlier release see <a href="http://msdn.com/data/ef" sourcefile="miscellaneous/rc1-rc2-upgrade.md" sourcestartlinenumber="7" sourceendlinenumber="7"><a href="http://msdn.com/data/ef" sourcefile="miscellaneous/rc1-rc2-upgrade.md" sourcestartlinenumber="7" sourceendlinenumber="7">http://msdn.com/data/ef</a></a>.</p>
</div>
<p sourcefile="miscellaneous/rc1-rc2-upgrade.md" sourcestartlinenumber="9" sourceendlinenumber="9">This article provides guidance for moving an application built with the RC1 packages to RC2.</p>
<h2 id="package-names-and-versions" sourcefile="miscellaneous/rc1-rc2-upgrade.md" sourcestartlinenumber="11" sourceendlinenumber="11">Package Names and Versions</h2>
<p sourcefile="miscellaneous/rc1-rc2-upgrade.md" sourcestartlinenumber="13" sourceendlinenumber="13">Between RC1 and RC2, we changed from &quot;Entity Framework 7&quot; to &quot;Entity Framework Core&quot;. You can read more about the reasons for the change in <a href="http://www.hanselman.com/blog/ASPNET5IsDeadIntroducingASPNETCore10AndNETCore10.aspx" sourcefile="miscellaneous/rc1-rc2-upgrade.md" sourcestartlinenumber="13" sourceendlinenumber="13">this post by Scott Hanselman</a>. Because of this change, our package names changed from <code>EntityFramework.*</code> to <code>Microsoft.EntityFrameworkCore.*</code> and our versions from <code>7.0.0-rc1-final</code> to <code>1.0.0-rc2-final</code> (or <code>1.0.0-preview1-final</code> for tooling).</p>
<p sourcefile="miscellaneous/rc1-rc2-upgrade.md" sourcestartlinenumber="15" sourceendlinenumber="15"><strong>You will need to completely remove the RC1 packages and then install the RC2 ones.</strong> Here is the mapping for some common packages.</p>
<table sourcefile="miscellaneous/rc1-rc2-upgrade.md" sourcestartlinenumber="17" sourceendlinenumber="27">
<thead>
<tr>
<th>RC1 Package</th>
<th>RC2 Equivalent</th>
</tr>
</thead>
<tbody>
<tr>
<td>EntityFramework.MicrosoftSqlServer        7.0.0-rc1-final</td>
<td>Microsoft.EntityFrameworkCore.SqlServer         1.0.0-rc2-final</td>
</tr>
<tr>
<td>EntityFramework.SQLite                    7.0.0-rc1-final</td>
<td>Microsoft.EntityFrameworkCore.SQLite            1.0.0-rc2-final</td>
</tr>
<tr>
<td>EntityFramework7.Npgsql                   3.1.0-rc1-3</td>
<td>NpgSql.EntityFrameworkCore.Postgres             <to be="" advised=""></to></td>
</tr>
<tr>
<td>EntityFramework.SqlServerCompact35        7.0.0-rc1-final</td>
<td>EntityFrameworkCore.SqlServerCompact35          1.0.0-rc2-final</td>
</tr>
<tr>
<td>EntityFramework.SqlServerCompact40        7.0.0-rc1-final</td>
<td>EntityFrameworkCore.SqlServerCompact40          1.0.0-rc2-final</td>
</tr>
<tr>
<td>EntityFramework.InMemory                  7.0.0-rc1-final</td>
<td>Microsoft.EntityFrameworkCore.InMemory          1.0.0-rc2-final</td>
</tr>
<tr>
<td>EntityFramework.IBMDataServer             7.0.0-beta1</td>
<td>Not yet available for RC2</td>
</tr>
<tr>
<td>EntityFramework.Commands                  7.0.0-rc1-final</td>
<td>Microsoft.EntityFrameworkCore.Tools             1.0.0-preview1-final</td>
</tr>
<tr>
<td>EntityFramework.MicrosoftSqlServer.Design 7.0.0-rc1-final</td>
<td>Microsoft.EntityFrameworkCore.SqlServer.Design  1.0.0-rc2-final</td>
</tr>
</tbody>
</table>
<h2 id="namespaces" sourcefile="miscellaneous/rc1-rc2-upgrade.md" sourcestartlinenumber="29" sourceendlinenumber="29">Namespaces</h2>
<p sourcefile="miscellaneous/rc1-rc2-upgrade.md" sourcestartlinenumber="31" sourceendlinenumber="31">Along with package names, namespaces changed from <code>Microsoft.Data.Entity.*</code> to <code>Microsoft.EntityFrameworkCore.*</code>. You can handle this change with a find/replace of <code>using Microsoft.Data.Entity</code> with <code>using Microsoft.EntityFrameworkCore</code>.</p>
<h2 id="table-naming-convention-changes" sourcefile="miscellaneous/rc1-rc2-upgrade.md" sourcestartlinenumber="33" sourceendlinenumber="33">Table Naming Convention Changes</h2>
<p sourcefile="miscellaneous/rc1-rc2-upgrade.md" sourcestartlinenumber="35" sourceendlinenumber="35">A significant functional change we took in RC2 was to use the name of the <code>DbSet&lt;TEntity&gt;</code> property for a given entity as the table name it maps to, rather than just the class name. You can read more about this change in <a href="https://github.com/aspnet/Announcements/issues/167" sourcefile="miscellaneous/rc1-rc2-upgrade.md" sourcestartlinenumber="35" sourceendlinenumber="35">the related announcement issue</a>.</p>
<p sourcefile="miscellaneous/rc1-rc2-upgrade.md" sourcestartlinenumber="37" sourceendlinenumber="37">For existing RC1 applications, we recommend adding the following code to the start of your <code>OnModelCreating</code> method to keep the RC1 naming strategy:</p>
<!-- literal_block"xml:space": "preserve", "classes  "backrefs  "names  "dupnames   -->
<pre sourcefile="miscellaneous/rc1-rc2-upgrade.md" sourcestartlinenumber="40" sourceendlinenumber="45"><code>foreach (var entity in modelBuilder.Model.GetEntityTypes())
{
    entity.Relational().TableName = entity.DisplayName();
}
</code></pre><p sourcefile="miscellaneous/rc1-rc2-upgrade.md" sourcestartlinenumber="47" sourceendlinenumber="47">If you want to adopt the new naming strategy, we would recommend successfully completing the rest of the upgrade steps and then removing the code and creating a migration to apply the table renames.</p>
<h2 id="adddbcontext--startupcs-changes-aspnet-core-projects-only" sourcefile="miscellaneous/rc1-rc2-upgrade.md" sourcestartlinenumber="49" sourceendlinenumber="49">AddDbContext / Startup.cs Changes (ASP.NET Core Projects Only)</h2>
<p sourcefile="miscellaneous/rc1-rc2-upgrade.md" sourcestartlinenumber="51" sourceendlinenumber="51">In RC1, you had to add Entity Framework services to the application service provider - in <code>Startup.ConfigureServices(...)</code>:</p>
<!-- literal_block"xml:space": "preserve", "classes  "backrefs  "names  "dupnames   -->
<pre sourcefile="miscellaneous/rc1-rc2-upgrade.md" sourcestartlinenumber="54" sourceendlinenumber="59"><code>services.AddEntityFramework()
  .AddSqlServer()
  .AddDbContext&lt;ApplicationDbContext&gt;(options =&gt;
    options.UseSqlServer(Configuration[&quot;ConnectionStrings:DefaultConnection&quot;]));
</code></pre><p sourcefile="miscellaneous/rc1-rc2-upgrade.md" sourcestartlinenumber="61" sourceendlinenumber="61">In RC2, you can remove the calls to <code>AddEntityFramework()</code>, <code>AddSqlServer()</code>, etc.:</p>
<!-- literal_block"xml:space": "preserve", "classes  "backrefs  "names  "dupnames   -->
<pre sourcefile="miscellaneous/rc1-rc2-upgrade.md" sourcestartlinenumber="64" sourceendlinenumber="67"><code>services.AddDbContext&lt;ApplicationDbContext&gt;(options =&gt;
  options.UseSqlServer(Configuration[&quot;ConnectionStrings:DefaultConnection&quot;]));
</code></pre><p sourcefile="miscellaneous/rc1-rc2-upgrade.md" sourcestartlinenumber="69" sourceendlinenumber="69">You also need to add a constructor, to your derived context, that takes context options and passes them to the base constructor. This is needed because we removed some of the scary magic that snuck them in behind the scenes:</p>
<!-- literal_block"xml:space": "preserve", "classes  "backrefs  "names  "dupnames   -->
<pre sourcefile="miscellaneous/rc1-rc2-upgrade.md" sourcestartlinenumber="72" sourceendlinenumber="77"><code>public ApplicationDbContext(DbContextOptions&lt;ApplicationDbContext&gt; options)
    : base(options)
{
}
</code></pre><h2 id="passing-in-an-iserviceprovider" sourcefile="miscellaneous/rc1-rc2-upgrade.md" sourcestartlinenumber="79" sourceendlinenumber="79">Passing in an IServiceProvider</h2>
<p sourcefile="miscellaneous/rc1-rc2-upgrade.md" sourcestartlinenumber="81" sourceendlinenumber="81">If you have RC1 code that passes an <code>IServiceProvider</code> to the context, this has now moved to <code>DbContextOptions</code>, rather than being a separate constructor parameter. Use <code>DbContextOptionsBuilder.UseInternalServiceProvider(...)</code> to set the service provider.</p>
<h3 id="testing" sourcefile="miscellaneous/rc1-rc2-upgrade.md" sourcestartlinenumber="83" sourceendlinenumber="83">Testing</h3>
<p sourcefile="miscellaneous/rc1-rc2-upgrade.md" sourcestartlinenumber="85" sourceendlinenumber="85">The most common scenario for doing this was to control the scope of an InMemory database when testing. See the updated <a href="testing.html" sourcefile="miscellaneous/rc1-rc2-upgrade.md" sourcestartlinenumber="85" sourceendlinenumber="85">Testing with InMemory</a> article for an example of doing this with RC2.</p>
<h3 id="resolving-internal-services-from-application-service-provider-aspnet-core-projects-only" sourcefile="miscellaneous/rc1-rc2-upgrade.md" sourcestartlinenumber="87" sourceendlinenumber="87">Resolving Internal Services from Application Service Provider (ASP.NET Core Projects Only)</h3>
<p sourcefile="miscellaneous/rc1-rc2-upgrade.md" sourcestartlinenumber="89" sourceendlinenumber="89">If you have an ASP.NET Core application and you want EF to resolve internal services from the application service provider, there is an overload of <code>AddDbContext</code> that allows you to configure this:</p>
<!-- literal_block"xml:space": "preserve", "classes  "backrefs  "names  "dupnames   -->
<pre sourcefile="miscellaneous/rc1-rc2-upgrade.md" sourcestartlinenumber="92" sourceendlinenumber="97"><code>services.AddEntityFrameworkSqlServer()
  .AddDbContext&lt;ApplicationDbContext&gt;((serviceProvider, options) =&gt;
    options.UseSqlServer(Configuration[&quot;ConnectionStrings:DefaultConnection&quot;])
           .UseInternalServiceProvider(serviceProvider)); );
</code></pre><div class="WARNING sourceFile=" miscellaneous/rc1-rc2-upgrade.md"="" sourcestartlinenumber="99" sourceendlinenumber="99" "=""><h5>Warning</h5><p sourcefile="miscellaneous/rc1-rc2-upgrade.md" sourcestartlinenumber="100" sourceendlinenumber="100">We recommend allowing EF to internally manage its own services, unless you have a reason to combine the internal EF services into your application service provider. The main reason you may want to do this is to use your application service provider to replace services that EF uses internally</p>
</div>
<h2 id="dnx-commands--net-cli-aspnet-core-projects-only" sourcefile="miscellaneous/rc1-rc2-upgrade.md" sourcestartlinenumber="102" sourceendlinenumber="102">DNX Commands =&gt; .NET CLI (ASP.NET Core Projects Only)</h2>
<p sourcefile="miscellaneous/rc1-rc2-upgrade.md" sourcestartlinenumber="104" sourceendlinenumber="104">If you previously used the <code>dnx ef</code> commands for ASP.NET 5 projects, these have now moved to <code>dotnet ef</code> commands. The same command syntax still applies. You can use <code>dotnet ef --help</code> for syntax information.</p>
<p sourcefile="miscellaneous/rc1-rc2-upgrade.md" sourcestartlinenumber="106" sourceendlinenumber="106">The way commands are registered has changed in RC2, due to DNX being replaced by .NET CLI. Commands are now registered in a <code>tools</code> section in <code>project.json</code>:</p>
<!-- literal_block"xml:space": "preserve", "classes  "backrefs  "names  "dupnames   -->
<pre sourcefile="miscellaneous/rc1-rc2-upgrade.md" sourcestartlinenumber="109" sourceendlinenumber="119"><code>&quot;tools&quot;: {
  &quot;Microsoft.EntityFrameworkCore.Tools&quot;: {
    &quot;version&quot;: &quot;1.0.0-preview1-final&quot;,
    &quot;imports&quot;: [
      &quot;portable-net45+win8+dnxcore50&quot;,
      &quot;portable-net45+win8&quot;
    ]
  }
}
</code></pre><div class="TIP sourceFile=" miscellaneous/rc1-rc2-upgrade.md"="" sourcestartlinenumber="121" sourceendlinenumber="121" "=""><h5>Tip</h5><p sourcefile="miscellaneous/rc1-rc2-upgrade.md" sourcestartlinenumber="122" sourceendlinenumber="122">If you use Visual Studio, you can now use Package Manager Console to run EF commands for ASP.NET Core projects (this was not supported in RC1). You still need to register the commands in the <code>tools</code> section of <code>project.json</code> to do this.</p>
</div>
<h2 id="package-manager-commands-require-powershell-5" sourcefile="miscellaneous/rc1-rc2-upgrade.md" sourcestartlinenumber="124" sourceendlinenumber="124">Package Manager Commands Require PowerShell 5</h2>
<p sourcefile="miscellaneous/rc1-rc2-upgrade.md" sourcestartlinenumber="126" sourceendlinenumber="126">If you use the Entity Framework commands in Package Manager Console in Visual Studio, then you will need to ensure you have PowerShell 5 installed. This is a temporary requirement that will be removed in the next release (see <a href="https://github.com/aspnet/EntityFramework/issues/5327" sourcefile="miscellaneous/rc1-rc2-upgrade.md" sourcestartlinenumber="126" sourceendlinenumber="126">issue #5327</a> for more details).</p>
<h2 id="using-imports-in-projectjson" sourcefile="miscellaneous/rc1-rc2-upgrade.md" sourcestartlinenumber="128" sourceendlinenumber="128">Using &quot;imports&quot; in project.json</h2>
<p sourcefile="miscellaneous/rc1-rc2-upgrade.md" sourcestartlinenumber="130" sourceendlinenumber="130">Some of EF Core&#39;s dependencies do not support .NET Standard yet. EF Core in .NET Standard and .NET Core projects may require adding &quot;imports&quot; to project.json as a temporary workaround.</p>
<p sourcefile="miscellaneous/rc1-rc2-upgrade.md" sourcestartlinenumber="132" sourceendlinenumber="132">When adding EF, NuGet restore will display this error message:</p>
<!-- literal_block"language": "csharp",", "xml:space": "preserve", "classes  "backrefs  "names  "dupnames  highlight_args}, "ids  "linenos": false -->
<pre sourcefile="miscellaneous/rc1-rc2-upgrade.md" sourcestartlinenumber="135" sourceendlinenumber="145"><code class="lang-text">Package Ix-Async 1.2.5 is not compatible with netcoreapp1.0 (.NETCoreApp,Version=v1.0). Package Ix-Async 1.2.5 supports:
  - net40 (.NETFramework,Version=v4.0)
  - net45 (.NETFramework,Version=v4.5)
  - portable-net45+win8+wp8 (.NETPortable,Version=v0.0,Profile=Profile78)
Package Remotion.Linq 2.0.2 is not compatible with netcoreapp1.0 (.NETCoreApp,Version=v1.0). Package Remotion.Linq 2.0.2 supports:
  - net35 (.NETFramework,Version=v3.5)
  - net40 (.NETFramework,Version=v4.0)
  - net45 (.NETFramework,Version=v4.5)
  - portable-net45+win8+wp8+wpa81 (.NETPortable,Version=v0.0,Profile=Profile259)
</code></pre><p sourcefile="miscellaneous/rc1-rc2-upgrade.md" sourcestartlinenumber="147" sourceendlinenumber="147">The workaround is to manually import the portable profile &quot;portable-net451+win8&quot;. This forces NuGet to treat this binaries that match this provide as a compatible framework with .NET Standard, even though they are not. Although &quot;portable-net451+win8&quot; is not 100% compatible with .NET Standard, it is compatible enough for the transition from PCL to .NET Standard. Imports can be removed when EF&#39;s dependencies eventually upgrade to .NET Standard.</p>
<p sourcefile="miscellaneous/rc1-rc2-upgrade.md" sourcestartlinenumber="149" sourceendlinenumber="149">Multiple frameworks can be added to &quot;imports&quot; in array syntax. Other imports may be necessary if you add additional libraries to your project.</p>
<!-- literal_block"language": "csharp",", "xml:space": "preserve", "classes  "backrefs  "names  "dupnames  highlight_args}, "ids  "linenos": false -->
<pre sourcefile="miscellaneous/rc1-rc2-upgrade.md" sourcestartlinenumber="152" sourceendlinenumber="159"><code class="lang-json">{
  &quot;frameworks&quot;: {
    &quot;netcoreapp1.0&quot;: {
      &quot;imports&quot;: [&quot;dnxcore50&quot;, &quot;portable-net451+win8&quot;]
    }
}
</code></pre><p sourcefile="miscellaneous/rc1-rc2-upgrade.md" sourcestartlinenumber="161" sourceendlinenumber="161">See <a href="https://github.com/aspnet/EntityFramework/issues/5176" sourcefile="miscellaneous/rc1-rc2-upgrade.md" sourcestartlinenumber="161" sourceendlinenumber="161">Issue #5176</a>.</p>

            </article>
          </div>
          
          <div class="hidden-sm col-md-2" role="complementary">
            <div class="sideaffix">
              <div class="contribution">
                <ul class="nav">
                  <li>
                    <a href="https://github.com/shirhatti/EntityFramework.Docs/blob/export-qa-fixes/ef/miscellaneous/rc1-rc2-upgrade.md/#L1" class="contribution-link">Improve this Doc</a>
                  </li>
                </ul>
              </div>
              <nav class="bs-docs-sidebar hidden-print hidden-xs hidden-sm affix" id="affix">
              <!-- <p><a class="back-to-top" href="#top">Back to top</a><p> -->
              </nav>
            </div>
          </div>
        </div>
      </div>
      
      <footer>
        <div class="grad-bottom"></div>
        <div class="footer">
          <div class="container">
            <span class="pull-right">
              <a href="#top">Back to top</a>
            </span>
            
            <span>Copyright © 2015-2016 Microsoft<br>Generated by <strong>DocFX</strong></span>
          </div>
        </div>
      </footer>
    </div>
    
    <script type="text/javascript" src="../styles/docfx.vendor.js"></script>
    <script>hljs.initHighlightingOnLoad();</script>
    <script type="text/javascript" src="../styles/docfx.js"></script>
    <script type="text/javascript" src="../styles/main.js"></script>
  </body>
</html>
