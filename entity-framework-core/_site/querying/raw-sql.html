<!DOCTYPE html>
<!--[if IE]><![endif]-->
<html>
  
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <title>Raw SQL Queries </title>
    <meta name="viewport" content="width=device-width">
    <meta name="title" content="Raw SQL Queries ">
    <meta name="generator" content="docfx 2.5.4.0">
    
    <link rel="shortcut icon" href="../favicon.ico">
    <link rel="stylesheet" href="../styles/docfx.vendor.css">
    <link rel="stylesheet" href="../styles/docfx.css">
    <link rel="stylesheet" href="../styles/main.css">
    <meta property="docfx:navrel" content="../toc.html">
    <meta property="docfx:tocrel" content="../toc.html">
    
  </head>
  <body data-spy="scroll" data-target="#affix">
    <div id="wrapper">
      <header>
        
        <nav id="autocollapse" class="navbar navbar-inverse ng-scope" role="navigation">
          <div class="container">
            <div class="navbar-header">
              <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#navbar">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
              </button>
              <a class="navbar-brand" href="../index.html">
                <img id="logo" class="svg" src="../logo.svg" alt="">
              </a>
            </div>
            <div class="collapse navbar-collapse" id="navbar">
              <form class="navbar-form navbar-right" role="search" id="search">
                <div class="form-group">
                  <input type="text" class="form-control" id="search-query" placeholder="Search" autocomplete="off">
                </div>
              </form>
            </div>
          </div>
        </nav>
        
        <div class="subnav navbar navbar-default">
          <div class="container hide-when-search" id="breadcrumb">
            <ul class="breadcrumb">
              <li></li>
            </ul>
          </div>
        </div>
      </header>
      <div role="main" class="container body-content hide-when-search">
        <div class="article row grid">
          <div class="col-md-10">
            <article class="content wrap" id="_content" data-uid="querying/raw-sql">
              <h1 id="raw-sql-queries" sourcefile="querying/raw-sql.md" sourcestartlinenumber="4" sourceendlinenumber="4">Raw SQL Queries</h1>
              
<div class="WARNING sourceFile=" querying/raw-sql.md"="" sourcestartlinenumber="6" sourceendlinenumber="6" "=""><h5>Warning</h5><p sourcefile="querying/raw-sql.md" sourcestartlinenumber="7" sourceendlinenumber="7">This documentation is for EF Core. For EF6.x and earlier release see <a href="http://msdn.com/data/ef" sourcefile="querying/raw-sql.md" sourcestartlinenumber="7" sourceendlinenumber="7"><a href="http://msdn.com/data/ef" sourcefile="querying/raw-sql.md" sourcestartlinenumber="7" sourceendlinenumber="7">http://msdn.com/data/ef</a></a>.</p>
</div>
<p sourcefile="querying/raw-sql.md" sourcestartlinenumber="9" sourceendlinenumber="9">Entity Framework Core allows you to drop down to raw SQL queries when working with a relational database. This can be useful if the query you want to perform can&#39;t be expressed using LINQ, or if using a LINQ query is resulting in inefficient SQL being sent to the database.</p>
<div class="TIP sourceFile=" querying/raw-sql.md"="" sourcestartlinenumber="11" sourceendlinenumber="11" "=""><h5>Tip</h5><p sourcefile="querying/raw-sql.md" sourcestartlinenumber="12" sourceendlinenumber="12">You can view this article&#39;s <a href="https://github.com/aspnet/EntityFramework.Docs/tree/master/samples/Querying" sourcefile="querying/raw-sql.md" sourcestartlinenumber="12" sourceendlinenumber="12">sample</a> on GitHub.</p>
</div>
<h2 id="limitations" sourcefile="querying/raw-sql.md" sourcestartlinenumber="14" sourceendlinenumber="14">Limitations</h2>
<p sourcefile="querying/raw-sql.md" sourcestartlinenumber="16" sourceendlinenumber="16">There are a couple of limitations to be aware of when using raw SQL queries:</p>
<ul sourcefile="querying/raw-sql.md" sourcestartlinenumber="17" sourceendlinenumber="23">
<li sourcefile="querying/raw-sql.md" sourcestartlinenumber="17" sourceendlinenumber="17"><p sourcefile="querying/raw-sql.md" sourcestartlinenumber="17" sourceendlinenumber="17">SQL queries can only be used to return entity types that are part of your model. There is an enhancement on our backlog to <a href="https://github.com/aspnet/EntityFramework/issues/1862" sourcefile="querying/raw-sql.md" sourcestartlinenumber="17" sourceendlinenumber="17">enable returning ad-hoc types from raw SQL queries</a>.</p>
</li>
<li sourcefile="querying/raw-sql.md" sourcestartlinenumber="19" sourceendlinenumber="19"><p sourcefile="querying/raw-sql.md" sourcestartlinenumber="19" sourceendlinenumber="19">The SQL query must return data for all properties of the entity type.</p>
</li>
<li sourcefile="querying/raw-sql.md" sourcestartlinenumber="21" sourceendlinenumber="21"><p sourcefile="querying/raw-sql.md" sourcestartlinenumber="21" sourceendlinenumber="21">The column names in the result set must match the column names that properties are mapped to. Note this is different from EF6.x where property/column mapping was ignored for raw SQL queries and result set column names had to match the property names.</p>
</li>
<li sourcefile="querying/raw-sql.md" sourcestartlinenumber="23" sourceendlinenumber="23"><p sourcefile="querying/raw-sql.md" sourcestartlinenumber="23" sourceendlinenumber="23">The SQL query cannot contain related data. However, in many cases you can compose on top of the query using the <code>Include</code> operator to return related data (see <a href="#including-related-data" sourcefile="querying/raw-sql.md" sourcestartlinenumber="23" sourceendlinenumber="23">Including related data</a>).</p>
</li>
</ul>
<h2 id="basic-raw-sql-queries" sourcefile="querying/raw-sql.md" sourcestartlinenumber="25" sourceendlinenumber="25">Basic raw SQL queries</h2>
<p sourcefile="querying/raw-sql.md" sourcestartlinenumber="27" sourceendlinenumber="27">You can use the <em>FromSql</em> extension method to begin a LINQ query based on a raw SQL query.</p>
<!-- [!code-csharp[Main](samples/Querying/Querying/RawSQL/Sample.cs)] -->
<pre sourcefile="querying/raw-sql.md" sourcestartlinenumber="30" sourceendlinenumber="34"><code class="lang-csharp">var blogs = context.Blogs
    .FromSql(&quot;SELECT * FROM dbo.Blogs&quot;)
    .ToList();
</code></pre><p sourcefile="querying/raw-sql.md" sourcestartlinenumber="36" sourceendlinenumber="36">Raw SQL queries can be used to execute a stored procedure.</p>
<!-- [!code-csharp[Main](samples/Querying/Querying/RawSQL/Sample.cs)] -->
<pre sourcefile="querying/raw-sql.md" sourcestartlinenumber="39" sourceendlinenumber="43"><code class="lang-csharp">var blogs = context.Blogs
    .FromSql(&quot;EXECUTE dbo.GetMostPopularBlogs&quot;)
    .ToList();
</code></pre><h2 id="passing-parameters" sourcefile="querying/raw-sql.md" sourcestartlinenumber="45" sourceendlinenumber="45">Passing parameters</h2>
<p sourcefile="querying/raw-sql.md" sourcestartlinenumber="47" sourceendlinenumber="47">As with any API that accepts SQL, it is important to parameterize any user input to protect against a SQL injection attack. You can include parameter placeholders in the SQL query string and then supply parameter values as additional arguments. Any parameter values you supply will automatically be converted to a <code>DbParameter</code>.</p>
<p sourcefile="querying/raw-sql.md" sourcestartlinenumber="49" sourceendlinenumber="49">The following example passes a single parameter to a stored procedure. While this may look like <code>String.Format</code> syntax, the supplied value is wrapped in a parameter and the generated parameter name inserted where the <code>{0}</code> placeholder was specified.</p>
<!-- [!code-csharp[Main](samples/Querying/Querying/RawSQL/Sample.cs)] -->
<pre sourcefile="querying/raw-sql.md" sourcestartlinenumber="52" sourceendlinenumber="58"><code class="lang-csharp">   var user = &quot;johndoe&quot;;

   var blogs = context.Blogs
.FromSql(&quot;EXECUTE dbo.GetMostPopularBlogsForUser {0}&quot;, user)
.ToList();
</code></pre><p sourcefile="querying/raw-sql.md" sourcestartlinenumber="60" sourceendlinenumber="60">You can also construct a DbParameter and supply it as a parameter value. This allows you to use named parameters in the SQL query string</p>
<!-- [!code-csharp[Main](samples/Querying/Querying/RawSQL/Sample.cs)] -->
<pre sourcefile="querying/raw-sql.md" sourcestartlinenumber="63" sourceendlinenumber="69"><code class="lang-csharp">var user = &quot;johndoe&quot;;

var blogs = context.Blogs
    .FromSql(&quot;EXECUTE dbo.GetMostPopularBlogsForUser {0}&quot;, user)
    .ToList();
</code></pre><h2 id="composing-with-linq" sourcefile="querying/raw-sql.md" sourcestartlinenumber="71" sourceendlinenumber="71">Composing with LINQ</h2>
<p sourcefile="querying/raw-sql.md" sourcestartlinenumber="73" sourceendlinenumber="73">If the SQL query can be composed on in the database, then you can compose on top of the initial raw SQL query using LINQ operators. SQL queries that can be composed on being with the <code>SELECT</code> keyword.</p>
<p sourcefile="querying/raw-sql.md" sourcestartlinenumber="75" sourceendlinenumber="75">The following example uses a raw SQL query that selects from a Table-Valued Function (TVF) and then composes on it using LINQ to perform filtering and sorting.</p>
<!-- [!code-csharp[Main](samples/Querying/Querying/RawSQL/Sample.cs)] -->
<pre sourcefile="querying/raw-sql.md" sourcestartlinenumber="78" sourceendlinenumber="86"><code class="lang-csharp">   var searchTerm = &quot;.NET&quot;;

   var blogs = context.Blogs
.FromSql(&quot;SELECT * FROM dbo.SearchBlogs {0}&quot;, searchTerm)
.Where(b =&gt; b.Rating &gt; 3)
.OrderByDescending(b =&gt; b.Rating)
.ToList();
</code></pre><h3 id="including-related-data" sourcefile="querying/raw-sql.md" sourcestartlinenumber="88" sourceendlinenumber="88">Including related data</h3>
<p sourcefile="querying/raw-sql.md" sourcestartlinenumber="90" sourceendlinenumber="90">Composing with LINQ operators can be used to include related data in the query.</p>
<!-- [!code-csharp[Main](samples/Querying/Querying/RawSQL/Sample.cs)] -->
<pre sourcefile="querying/raw-sql.md" sourcestartlinenumber="93" sourceendlinenumber="99"><code class="lang-csharp">var user = new SqlParameter(&quot;user&quot;, &quot;johndoe&quot;);

var blogs = context.Blogs
    .FromSql(&quot;EXECUTE dbo.GetMostPopularBlogsForUser @user&quot;, user)
    .ToList();
</code></pre>
            </article>
          </div>
          
          <div class="hidden-sm col-md-2" role="complementary">
            <div class="sideaffix">
              <div class="contribution">
                <ul class="nav">
                  <li>
                    <a href="https://github.com/shirhatti/EntityFramework.Docs/blob/export-qa-fixes/ef/querying/raw-sql.md/#L1" class="contribution-link">Improve this Doc</a>
                  </li>
                </ul>
              </div>
              <nav class="bs-docs-sidebar hidden-print hidden-xs hidden-sm affix" id="affix">
              <!-- <p><a class="back-to-top" href="#top">Back to top</a><p> -->
              </nav>
            </div>
          </div>
        </div>
      </div>
      
      <footer>
        <div class="grad-bottom"></div>
        <div class="footer">
          <div class="container">
            <span class="pull-right">
              <a href="#top">Back to top</a>
            </span>
            
            <span>Copyright © 2015-2016 Microsoft<br>Generated by <strong>DocFX</strong></span>
          </div>
        </div>
      </footer>
    </div>
    
    <script type="text/javascript" src="../styles/docfx.vendor.js"></script>
    <script>hljs.initHighlightingOnLoad();</script>
    <script type="text/javascript" src="../styles/docfx.js"></script>
    <script type="text/javascript" src="../styles/main.js"></script>
  </body>
</html>
